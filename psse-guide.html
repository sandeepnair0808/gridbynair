import sys
import os

#################
# User Input
#################
psseversion = 35  # Change this to 33, 34, or 35 depending on your installed version
#################

# Automatically detect current Python version
pythonversion = '{}.{}'.format(sys.version_info[0], sys.version_info[1])
print("Detected Python version:", pythonversion)

#####################################
# Load psspy and set PATH variables
#####################################

if psseversion == 35:
    if pythonversion in ['2.7', '3.7', '3.8', '3.9']:
        pyver_short = int(pythonversion.replace('.', ''))
        psse_path = r"C:\Program Files\PTI\PSSE35\35.3\PSSPY{}".format(pyver_short)
        sys.path.append(psse_path)
        os.environ['PATH'] = psse_path + ";" + os.environ['PATH']
        import psse35
    else:
        print("Unsupported Python version for PSSE 35. Use 2.7, 3.7, 3.8, or 3.9 (64-bit).")
        sys.exit()

elif psseversion == 34:
    if pythonversion in ['2.7', '3.4', '3.7', '3.9']:
        pyver_short = int(pythonversion.replace('.', ''))
        psse_path = r"C:\Program Files (x86)\PTI\PSSE34\PSSPY{}".format(pyver_short)
        sys.path.append(psse_path)
        os.environ['PATH'] = psse_path + ";" + os.environ['PATH']
        import psse34
    else:
        print("Unsupported Python version for PSSE 34. Use 32-bit Python 2.7, 3.4, 3.7, or 3.9.")
        sys.exit()

elif psseversion == 33:
    if pythonversion == '2.7':
        psse_path = r"C:\Program Files (x86)\PTI\PSSE33\PSSBIN"
        sys.path.append(psse_path)
        os.environ['PATH'] = psse_path + ";" + os.environ['PATH']
    else:
        print("Unsupported Python version for PSSE 33. Use 32-bit Python 2.7.")
        sys.exit()
else:
    print("Invalid PSSE version. Choose 33, 34, or 35.")
    sys.exit()

#####################################
# Initialize PSSE
#####################################
try:
    import psspy
    psspy.psseinit(buses=150000)
    print("PSSE initialized successfully.")
except Exception as e:
    print("Error initializing PSSE:", str(e))
